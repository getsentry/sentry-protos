syntax = "proto3";

package sentry_protos.snuba.v1;

import "sentry_protos/snuba/v1/trace_item_attribute.proto";

message AndFilter {
  repeated TraceItemFilter filters = 1;
}

message OrFilter {
  repeated TraceItemFilter filters = 1;
}

message NotFilter {
  repeated TraceItemFilter filters = 1;
}

message ComparisonFilter {
  enum Op {
    OP_UNSPECIFIED = 0;
    OP_LESS_THAN = 1;
    OP_GREATER_THAN = 2;
    OP_LESS_THAN_OR_EQUALS = 3;
    OP_GREATER_THAN_OR_EQUALS = 4;
    OP_EQUALS = 5;
    OP_NOT_EQUALS = 6;
    OP_LIKE = 7; //string only
    OP_NOT_LIKE = 8; //string only
    OP_IN = 9; // array only
    OP_NOT_IN = 10; // array only
  }
  AttributeKey key = 1;
  Op op = 2;
  AttributeValue value = 3;

  // optional, if set will ignore case for string comparisons
  bool ignore_case = 4;
}

message ExistsFilter {
  AttributeKey key = 1;
}

// Filter that matches trace items where ANY attribute matches the given value.
// Use this for searching across all attributes without specifying a key.
message AnyAttributeFilter {
  // Restricted set of operations that make sense for all-attribute search
  enum Op {
    OP_UNSPECIFIED = 0;
    OP_EQUALS = 1;
    OP_NOT_EQUALS = 2;
    OP_LIKE = 3;
    OP_NOT_LIKE = 4;
    OP_IN = 5;
    OP_NOT_IN = 6;
  }

  Op op = 1;
  AttributeValue value = 2;
  bool ignore_case = 3;

  // Optional: Restrict search to specific attribute types.
  // If empty, searches all string-type attributes by default.
  repeated AttributeKey.Type attribute_types = 4;
}

// a condition used to filter for matching "trace items"
//
// ex: "exists span.duration" would mean
// "only give me trace items that have the attribute 'span.duration'"
//
// ( traces contain trace items,
//   eg. trace items are: span, replay, error, etc,
//   trace items contain attributes like 'span.duration' )
message TraceItemFilter {
  oneof value {
    AndFilter and_filter = 1;
    OrFilter or_filter = 2;
    NotFilter not_filter = 3;
    ComparisonFilter comparison_filter = 4;
    ExistsFilter exists_filter = 5;
    AnyAttributeFilter any_attribute_filter = 6;
  }
}
