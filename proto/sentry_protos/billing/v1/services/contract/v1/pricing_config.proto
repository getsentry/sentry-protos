syntax = "proto3";

package sentry_protos.billing.v1.services.contract.v1;

import "sentry_protos/billing/v1/services/contract/v1/billing_config.proto";

enum SKU {
  SKU_UNSPECIFIED = 0;
  SKU_ERRORS = 1;
  SKU_SPANS = 2;
  SKU_REPLAYS = 3;
  SKU_PERFORMANCE_UNITS = 4;
  SKU_CRON = 5;
  SKU_UPTIME = 6;
  SKU_ATTACHMENTS = 7;
  SKU_PROFILING = 8;
  SKU_PROFILING_UI = 9;
  SKU_LOGS = 10;
  SKU_SEER = 11;
  SKU_SIZE_ANALYSIS = 12;
  SKU_BUILD_DISTRIBUTION = 13;
  SKU_AUTOFIX = 14;
  SKU_SCANNER = 15;
}

message PricingTier {
  int64 start = 1;
  int64 end = 2;
  int64 rate_per_unit_cpe = 3;
}

message TieredPricingRate {
  repeated PricingTier tiers = 1;
}

message SKUConfig {
  SKU sku = 1;
  // Base price for the SKU (upgraded reserved volumes or add-on activation fees)
  uint64 base_price_cents = 2;
  optional uint64 payg_budget_cents = 3;
  uint64 reserved_volume = 4;
  TieredPricingRate payg_rate = 5;
  TieredPricingRate reserved_rate = 6; // for reserved budget SKUs
}

// Represents a budget that is collectively used by one or more SKUs,
// allowing multiple SKUs to draw from the same reserved budget.
message SharedSKUBudget {
  repeated SKU skus = 1;
  uint64 reserved_budget_cents = 2;
  uint64 payg_budget_cents = 3;
}

message PricingConfig {
  repeated SKUConfig sku_configs = 1;
  repeated SharedSKUBudget shared_sku_budgets = 2;
  // Determines when to reset quotas and create an invoice.
  Date billing_period_start_date = 3;
  Date billing_period_end_date = 4;

  uint64 max_spend_cents = 5;
  // Base price for the package.
  uint64 base_price_cents = 6;
}
